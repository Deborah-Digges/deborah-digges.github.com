{"componentChunkName":"component---src-templates-blog-template-js","path":"/2020/09/16/Jekyll-to-Gatsby/","result":{"data":{"markdownRemark":{"html":"<p>Six years ago, during my final year in college, I was enrolled in a course on Open Source technology. To pass the course was to do two things: contribute to an open source project, and blog about it. Laughably, the only thing that propelled me to start writing publicly was the fear of failing the class.</p>\n<p>I passed the course and managed to get some semblance of a blog together. However, I didn't put too much effort into building the site itself since much of my effort was expended in writing the content and trying to creep my way into open source. At the time, Jekyll was all the rage and I went with a themed Jekyll starter called <a href=\"https://github.com/poole/lanyon\">Lanyon</a>.</p>\n<p>It served me well over the years, but my unfamiliarity with how it worked kept me from making any substantial changes to the structure of the site. I've finally taken the stand to move to a stack I'm more comfortable with.</p>\n<h2>Why Gatsby?</h2>\n<p>I considered refurbishing my blog with <a href=\"https://www.gatsbyjs.com/blog/2017-11-08-migrate-from-jekyll-to-gatsby/\">Gatsby</a> and <a href=\"https://dev.to/joserfelix/how-to-make-a-static-blog-with-next-js-2bd6\">Next</a>. I decided to go with Gatsby since it is a little more specialized towards static site generation.</p>\n<h2>Let's Get Migrating</h2>\n<h3>Scaffolding</h3>\n<p>Getting a Gatsby project up and running is <a href=\"https://www.gatsbyjs.com/docs/quick-start/\">well-documented</a> on the Gatsby site. Enhancing the project to generate a page from a markdown file is also <a href=\"https://www.gatsbyjs.com/docs/adding-markdown-pages/\">clearly explained</a>.\nThese are the steps I followed to get the initial project set up for the blog:</p>\n<ul>\n<li>Used the <code>gatsby-source-filesystem</code> plugin to read markdown files into Gatsby. I added an entry to the <code>plugins</code> key in <code>gatsby.config.js</code>.</li>\n</ul>\n<pre><code>plugins: [{\n   resolve: `gatsby-source-filesystem`,\n   options: {\n    name: `markdown-pages`,\n    path: `${__dirname}/src/markdown-pages`\n  }\n}]\n</code></pre>\n<ul>\n<li>Parsed markdown files using the <code>gatsby-transformer-remark</code> plugin which extracted the frontmatter as data and the content as HTML.</li>\n</ul>\n<pre><code>plugins: [\n  {\n    resolve: `gatsby-source-filesystem`,\n    options: {\n      name: `markdown-pages`,\n      path: `${__dirname}/src/markdown-pages`\n    },\n  },\n  `gatsby-transformer-remark`\n]\n</code></pre>\n<ul>\n<li>Created a <a href=\"https://github.com/Deborah-Digges/gatsby-site/blob/master/src/templates/blogTemplate.js\">template</a> for blog posts using React to render a blog post's data as a React component.</li>\n<li>Generated pages for all markdown files using the <a href=\"https://github.com/Deborah-Digges/gatsby-site/blob/master/gatsby-node.js#L55\"><code>createPage</code> Gatsby API</a>.</li>\n<li>Created an <a href=\"https://github.com/Deborah-Digges/gatsby-site/blob/master/src/pages/index.js\">index page</a> for all blog articles that displayed a list of links.</li>\n</ul>\n<h3>Migrating Content</h3>\n<p>I copied all the markdown files from my old website to the folder indicated in the <code>gatsby-source-filesystem</code> config entry: <code>markdown-pages</code>. I was now able to see all my old blogs being listed on the index page, but most of the posts themselves looked terribly broken.</p>\n<h3>Fixing All the Things</h3>\n<h4>Links</h4>\n<p>To avoid breaking links, I used the same slug format that my old Jekyll site used: <code>YYYY/MM/DD/Title</code>. In my case, the slug was derived from the filename instead of the frontmatter, which required a little special handling.</p>\n<ul>\n<li>To access the filename, I used <a href=\"https://github.com/Deborah-Digges/gatsby-site/blob/master/gatsby-node.js#L8\">createFilePath</a>.</li>\n<li>I extracted the slug and the date from the filename and passed them along as node fields, available to subsequent page queries.</li>\n</ul>\n<pre><code>const result = extractMetadataFromFilename(filePath);\ndate = result.date;\nslug = result.slug;\ncreateNodeField({ node, name: `date`, value: date });\n</code></pre>\n<h4>Highlighting</h4>\n<p>In my old Jekyll site, I was using <code>pygments</code> for syntax highlighting of code snippets, which used syntax like this to create a highlight:</p>\n<pre><code>{% highlight C++ %}\n{% raw %}\n  void f(int x, int n)\n  {\n    Gadget * g = new Gadget{n}; // Look ! Iâ€™m a Java Programmer :)\n    if(x &#x3C; 100) throw std::runtime_error{\"weird\"}; //leak\n    if(x &#x3C; 200) return; //leak\n    delete p;\n  }\n{% endraw %}\n{% endhighlight %}\n</code></pre>\n<p>Since this no longer worked in Gatsby, I changed all highlights to be enclosed in three back-quotes which translates to a <code>&#x3C;pre></code> tag enclosing a <code>&#x3C;code></code> blog.</p>\n<p>I would like to eventually embed gists directly into my posts, but that's an improvement for a later blog post.</p>\n<h4>Images</h4>\n<p>First, I copied over the images from my old site to <code>src/images</code>. To make Gatsby aware of where my images were located, I added another plugin entry for the <code>gatsby-source-filesystem</code> plugin.</p>\n<pre><code>{\n  resolve: `gatsby-source-filesystem`,\n  options: {\n    name: `images`,\n    path: `${__dirname}/src/images`,\n  },\n}\n</code></pre>\n<p>I then modified the plugin entry for <code>gatsby-trasformer-remark</code> to add the <code>gatsby-remark-images</code> plugin to it.</p>\n<pre><code>{\n  resolve: `gatsby-transformer-remark`,\n  options: {\n    plugins: [\n      {\n        resolve: `gatsby-remark-images`,\n        options: {\n          maxWidth: 800,\n        },\n      },\n    ],\n  },\n}\n</code></pre>\n<p>With this configuration, I was able to embed images inline using the familiar markdown format:</p>\n<pre><code>![Architecture](../images/NN.jpg)\n</code></pre>\n<p>It's important to use a relative path to the <code>images</code> folder.</p>\n<pre><code>- src\n  - markdown-pages\n  - images\n</code></pre>\n<p>For the directory structure above, <code>../images/image.png</code> would be the path to an image referenced in a markdown file.</p>\n<h4>Gifs</h4>\n<p><code>gatsby-remark-images</code> cannot handle gifs. I added the <code>gatsby-remark-copy-linked-files</code> plugin to properly handle any gifs that gatsby encountered.</p>\n<pre><code>{\n  resolve: `gatsby-transformer-remark`,\n  options: {\n    plugins: [\n      {\n        resolve: `gatsby-remark-images`,\n        options: {\n          maxWidth: 800,\n        },\n      },\n      `gatsby-remark-copy-linked-files`\n    ],\n  },\n}\n</code></pre>\n<h4>Favicon</h4>\n<p>Again, I invoked the mighty plugin system of Gatsby and added another plugin entry in <code>gatsby-config.js</code>.</p>\n<pre><code>{\n  resolve: `gatsby-plugin-favicon`,\n  options: {\n    logo: `./src/favicon.ico`\n  }\n}\n</code></pre>\n<h3>Styling</h3>\n<p>I lazily copied over the <a href=\"https://github.com/Deborah-Digges/gatsby-site/tree/master/src/styles\">poole/lanyon theme</a> to avoid me having to write any CSS. Let's not kid ourselves, I don't really know how to design a site.</p>\n<p>Since these are global CSS styles, I needed to import them into the <code>gatsby-browser.config.js</code> file to make them apply to the generated HTML files.</p>\n<pre><code>import './src/styles/poole.css';\nimport './src/styles/lanyon.css';\nimport './src/styles/Calendas_Plus.otf';\n</code></pre>\n<h3>Deploying</h3>\n<p>To test the site out and compare it with my old site, I <a href=\"https://epic-mirzakhani-8e39a6.netlify.app/\">deployed</a> the site to <a href=\"https://www.netlify/\">Netlify</a>. It was about as simple as going to the Netlify site, authorizing access to my GitHub repo, and providing a build command.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/49727328eec4980fb91fad5948fab837/a2b91/netlify-build-command.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA70lEQVQoz42SC2/DIAyE+///5bSpU56ASQLlkZsPJVLaSVWRTkBkfzbn3LaUEHLG+njArytyKSi1optm/HQdvu53DMZCtg1LjGD8O92uwG8mT5MCC4wIfvsBsiyIGpNYaN9RgVYwX8T8k9OAmx6C7oN2NRmDxIAQmrgiu1eweA/vF1SFQOH7ofgKDAdwVhgTGWTFH91WGOdgnTQw1Wy56KnDcBz4gbBziXYyjlNLsAoULcDFYuUTIHcm5VxaolV4rz46HUQvDqPebQwtjlA++9Q/YPNQxSkHfRLNFz0P89yGQeOTDiodf8B+8a++ePgHkSUiSXPfQhcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Build Command\"\n        title=\"Build Command\"\n        src=\"/static/49727328eec4980fb91fad5948fab837/5a190/netlify-build-command.png\"\n        srcset=\"/static/49727328eec4980fb91fad5948fab837/772e8/netlify-build-command.png 200w,\n/static/49727328eec4980fb91fad5948fab837/e17e5/netlify-build-command.png 400w,\n/static/49727328eec4980fb91fad5948fab837/5a190/netlify-build-command.png 800w,\n/static/49727328eec4980fb91fad5948fab837/c1b63/netlify-build-command.png 1200w,\n/static/49727328eec4980fb91fad5948fab837/29007/netlify-build-command.png 1600w,\n/static/49727328eec4980fb91fad5948fab837/a2b91/netlify-build-command.png 3360w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>Testing that No Links are Broken</h3>\n<p>With my site deployed to Netlify, I tested that no links would be broken by ensuring that each link on the old site also existed on the new site:</p>\n<pre><code>links.forEach(link => {\n  link = link.replace('deborah-digges.github.io', 'epic-mirzakhani-8e39a6.netlify.app');\n  request(link, (err, res, body) => {\n    if (err) { console.log('Page fetch failed', err); }\n    console.log(link, res.statusCode);\n  });\n});\n</code></pre>\n<p>I ran the following script on each of the two pages of my old blog to extract all the links:</p>\n<pre><code>let links = document.querySelectorAll('a');\nlet siteLinks = []\nfor (let i=0; i &#x3C; links.length; i++) {\n  let linkText = links[i].textContent;\n  linkText = linkText.replace(/\\s+/g, ' ').trim();\n  const link = links[i].href;\n  siteLinks.push([linkText, link]);\n}\n\nfor(let i=0; i &#x3C; siteLinks.length; i++) {\n  console.log(siteLinks[i][1]);\n}\n</code></pre>\n<p>Admittedly, it's a little rudimentary, but hey! it did the job.</p>\n<h3>Switching over</h3>\n<p>Once I was ready to bid adieu to the shackles of my Jekyll site, I overwrote my Github User Pages <a href=\"https://github.com/Deborah-Digges/deborah-digges.github.io\">repository</a> with the shiny new Gatsby site. I will be going over the details of deploying a Gatsby site to GitHub Pages in a subsequent blog post!</p>\n<h2>Next Up</h2>\n<p>Now that I'm using a system I understand a little better, I want to soon:</p>\n<ul>\n<li>Implement pagination</li>\n<li>Create categories for pages and allow browsing the blog by category</li>\n<li>Create a navigation element called <code>Content</code> in the header which expands to <code>Blogs</code>, <code>Drawings</code>, <code>Book Reviews</code></li>\n<li>Create a <code>Reading List</code> navigation element</li>\n<li>Lean enough about CSS and design to create a better landing page (Maybe hire a designer?)</li>\n</ul>\n<p>If you'd like to check it out in more detail, you can find the source code <a href=\"https://github.com/Deborah-Digges/gatsby-site\">here</a>.</p>\n<p>Tune in again for more exciting updates to my Gatsby blog!</p>","frontmatter":{"title":"From Jekyll to Gatsby: 7 Simple Steps"},"fields":{"date":"2020-09-16","slug":"2020/09/16/Jekyll-to-Gatsby/"}}},"pageContext":{"slug":"2020/09/16/Jekyll-to-Gatsby/","date":"2020-09-16"}},"staticQueryHashes":[]}